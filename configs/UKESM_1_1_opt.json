{
  "history": "Optimisation configuration for UKESM trial. Perturbing 4 model parameters based on HadAM3 CMIP6 config. Do define OPT_ST_UKESM in your env.  ",
  "Developer_comment": "StudyConfig.py provides methods that work with this configuration file. Remember to change them if you change structure of this.",
  "version": 2,
  "version_comment": "Version ID",
  "Name": "XSTUDYNAMEX",
  "Name_comment": "Study Name field overwritten by controlling Cylc suite",
  "baseRunID": "ND",
  "baseRunID_comment": "base for runID. Only first two characters are generally used.",
  "runTime": null,
  "runTime_comment": "Time in seconds for run. ",
  "runCode": "n02-TERRAFIRMA",
  "runCode_comment": "Project code to run job under.",
  "machineName": "slurm",
  "machineName_comment": "Name of machine to submit runs to",
  "modelName": "UKESM1_1",
  "modelName_comment": "Name of model that is ran",
  "optimiseFunction": null,
  "optimiseFunction_comment": "Name of optimisation function to run. null gives default",
  "fakeFunction": null,
  "fakeFunction_comment": "Name of fake function to use for testing. null gives default. Your fake fn should match your postProcess function which it fakes.",
  "runUpgrade_vn3": "For vn3 put all runXXX & function stuff in a runInfo block.",
  "Parameters": {
    "comment": "Information relevant to parameters. See Table 1 of Sexton et al, 2021 doi: 10.1007/s00382-021-05709-9 & UM",
    "comment_comment": "Would be nice if this information could be built by querying the reference model",
    "defaultParams": {
      "comment": "Default parameter values for HadGEM-GA10. null values or not set mean don't modify.  ",
      "DP_CORR_STRAT": 10000.000,
      "DP_CORR_STRAT_comment": "Decorrelation scale pressure.",
      "TWO_D_FSD_FACTOR": 1.5,
      "TWO_D_FSD_FACTOR_comment": "Scaling to make sub-grid cloud condensate variance to cloud cover and convective activity two dimensional.",
      "ENT_FAC_DP": 1.13,
      "ENT_FAC_DP_comment": "Deep entrainment amplitude",
      "AI": 2.57e-2,
      "AI_comment": "Linear scaling on pwer-law behaviour for ice mass -- ice density"
    },
    "initParams": {
      "comment": "Intial values for parameters to be optimised. Set to null to use default values.  ",
      "DP_CORR_STRAT": null,
      "TWO_D_FSD_FACTOR": null,
      "ENT_FAC_DP": null,
      "AI": null
    },
    "initScale": false,
    "initScale_comment": "If true then startParams range from 0 to 1 where 0 means min value; 1 max value. Fails to work when values are null and initScale is true",
    "fixedParams": {
      "comment": " List of parameters and values that are fixed and not modified in optimisation. Set to null to use default values"
    },
    "fixedScale": false,
    "fixedScale_comment": "If true then scalable fixedParams range from 0 to 1 where 0 means min value; 1 max value.",
    "minmax": {
      "comment": "Defines the minimum and maximum ranges for the parameters. Must be defined for ALL parameters used. From Sexton et al, 2021. See https://github.com/qump-project/qump-hadgem3",
      "commentOnEntFac": "fcm_make_um/extract/um/src/atmosphere/convection/cv_run_mod.F90 defines some also, tightened ent_fac_dp from intended 4 to 2",
      "DP_CORR_STRAT": [
        2500.0,
        40000
      ],
      "TWO_D_FSD_FACTOR": [
        1.0,
        2.0
      ],
      "ENT_FAC_DP": [
        0,
        2.0
      ],
      "AI": [
        6.1e-3,
        5.55e-2
      ]
    },
    "steps": {
      "comment": "Steps for perturbations -- norm around 10% of the range. If not specified 10% will be used. None specified as DFOLS does not use",
      "STEPS": "Put step values here if wanted"
    }
  },
  "study": {
    "comment": "Parameters that specify the study. Used by framework and not by optimisation routines",
    "referenceModelDirectory": "$OPTCLIMTOP/Configurations/NOTUSED",
    "referenceModelDirectory_comment": "Directory where reference model configuration exists. Default is START_DIR/start. ",
    "covariance": {
      "comment": "Covariance matrices and operations on them. If CovObsErr and CovIntVar are *both* specified then CovTotal will be computed from them. TODO MOVE coviariance info somewhere else..",
      "CovTotal": null,
      "CovTotal_Comment": "Name of file containing Covariance Matrix for total Error.",
      "CovTotalDiagonalise": false,
      "CovTotalDiagonalise_comment": "If true diagonalise the total covariance matrix",
      "CovIntVar": "$OPT_ST_UKESM/covariance/GAMIL3_intvar_2011_nudged_3regions.csv",
      "CovIntVar_Comment": "Name of file containing Covariance Matrix of Internal Variability.",
      "CovIntVarDiagonalise": false,
      "CovIntVarDiagonalise_comment": "If true diagonalise the internal variability covariance matrix",
      "CovObsErr": "$OPT_ST_UKESM/covariance/obserr2012.csv",
      "CovObsErr_Comment": "Name of file containing Covariance Matrix for Observational Error. ",
      "CovObsErrDiagonalise": true,
      "CovObsErrDiagonalise_comment": "If true diagonalise the Observational Error covariance matrix"
    },
    "ObsList": [
      "OLR_NHX",
      "OLR_TROPICS",
      "OLR_SHX",
      "OLRC_NHX",
      "OLRC_TROPICS",
      "OLRC_SHX",
      "RSR_NHX",
      "RSR_TROPICS",
      "RSR_SHX",
      "RSRC_NHX",
      "RSRC_TROPICS",
      "RSRC_SHX",
      "LAT_NHX",
      "LAT_TROPICS",
      "LAT_SHX",
      "Lprecip_NHX",
      "Lprecip_TROPICS",
      "Lprecip_SHX",
      "Reff_NHX",
      "Reff_TROPICS",
      "Reff_SHX",
      "TEMP@500_NHX",
      "TEMP@500_TROPICS",
      "TEMP@500_SHX",
      "RH@500_NHX",
      "RH@500_TROPICS",
      "RH@500_SHX",
      "MSLP_NHX_DGM",
      "MSLP_TROPICS_DGM"
    ],
    "ObsList_comment": "List of Observations that Algorithm uses which should be generated by post processing of model. ",
    "constraintName": "netflux_GLOBAL",
    "constraintName_comment": "Name of constraint variable -- target value defined by targets/constraintName. "
  },
  "optimise": {
    "comment": "Parameters to control optimisation. This is used within DFOLS optimisation routines AND not by framework",
    "algorithm": "DFOLS",
    "algorithm_comment": "Algorithm wanted.",
    "sigma": true,
    "sigma_comment": "If True use constraint weights",
    "mu": 0.01,
    "mu_comment": "The inverse weighting given to the constraint -- it gets wt 1/(2mu). If Null then no constraint should be applied. TO UPDATE",
    "dfols": {
      "growing.ndirs_initial": null,
      "growing.ndirs_initial_comment": "the number of perturbations on first iteration. If not specified then will make Nparm perturbtions",
      "rhobeg": 0.18,
      "rhobeg_comment": "Radius of parameter trust region at start",
      "rhoend": 0.1,
      "rhoend_comment": "Radius of parameter trust region for termination (for our purpose this is in normalised parameters)",
      "maxfun": 7,
      "maxfun_comment": "Maximum number of model evaluations to be done. Default is O(1000).   ",
      "scaling_within_bounds": true,
      "scaling_within_bounds_comment": "Scale internally so all in range 0 to 1",
      "namedSettings": {
        "logging.save_poisedness": false,
        "logging.save_poisedness_comment": "whether or not  to calculate geometry statistics as part of diagnostic information",
        "init.random_initial_directions": true,
        "init.random_initial_directions_comment": "If true perturb in random directions. If true perturb along co-ordinate axis.",
        "init.run_in_parallel": true,
        "init.run_in_parallel_comment": "Run initial cases in parallel",
        "noise.additive_noise_level": 3.0,
        "noise.additive_noise_level_comment": "Estimate of noise in cost function. Used in termination -- nb cost fn is sum of squares **not** sum of squares/nObs. Thsi case nudged so noise small ",
        "logging.save_diagnostic_info": true,
        "logging.save_diagnostic_info_comment": "Save logging info",
        "logging.save_xk": true,
        "logging.save_xk_comment": "Save the full vector of trial values ",
        "noise.quit_on_noise_level": true,
        "noise.quit_on_noise_level_comment": "quit/restart if all trial evaluations are within noise level of last iteration",
        "general.check_objfun_for_overflow": false,
        "general.check_objfun_for_overflow_comment": "Presumably check that function behaves itself",
        "slow.history_for_slow": 2,
        "slow.history_for_slow_comment": "No of past successful iterations to look at to decide if slow or not",
        "slow.thresh_for_slow": 0.1,
        "slow.thresh_for_slow_comment": "Log cost function  change for slow converegence",
        "slow.max_slow_iters": 5,
        "slow.max_slow_iters_comment": "The number of itertions (once slow determined) to decide making slow progress",
        "restarts.use_restarts": true,
        "restarts.use_restarts_comment": "Restart when slow convergence or too noisy",
        "restarts.use_soft_restarts": true,
        "restarts.use_soft_restarts_comment": "Use soft restart -- reuse some existing points when  restarting",
        "restarts.soft.num_geom_steps": 3,
        "restarts.soft.num_geom_steps_comment": "How many extra runs to be done when restarting",
        "restarts.increase_npt": false,
        "restarts.increase_npt_comment": "Increase number of points when restarting",
        "restarts.increase_npt_amt_comment": "Number of points to increase by in restarts.increase_npt set when restarting",
        "restarts.max_unsuccessful_restarts": 100,
        "restarts.max_unsuccessful_restarts_comment": "Number of consecutive restarts allowed when no progress made",
        "restarts.hard.increase_ndirs_initial_amt": 1,
        "restarts.hard.increase_ndirs_initial_amt_comment": "How many points to increase by  when doing hard restart (not using any exisiting pts)",
        "restarts.max_npt": null,
        "restarts.max_npt_comment": "Maximum number of points/model evals in each restart",
        "tr_radius.gamma_dec": 0.8,
        "tr_radius.alpha1": 0.9,
        "tr_radius.alpha2": 0.95
      },
      "NamedSettings_comment": "Settings for named parameters that get passed into dfols via user_params"
    },
    "dfols_comment": "Settings for DFOLS"
  },
  "postProcess": {
      "comment": "Options to control post processing. Details depend on your post processing script. ",
      "script": "$OPT_ST_UKESM/post_process/simobs_wrapper_UKESM1_1.sh",
      "script_comment": "Full path name -- including any environment variables you might have -- to postprocessing script",
      "outputPath": "observations.json",
      "outputPath_comment": "Name of output path relative to model dir and should be one of .nc, .json or .csv. Default is observations.nc. ",
      "note": "Specify mask_fraction (using land fract diag)  start and end times",
      "mask_file":"$OPT_ST_UKESM/post_process/landfrac_N96.nc",
      "mask_file_comment":"Path for landfrac file.",
      "mask_fraction": 0.5,
      "mask_fraction_comment": "Critical Fraction. Specify if mask  is a land/sea fraction. Values >= are land < sea. Set to null if mask is a t/f mask",
      "start_time": "2011-01-01",
      "start_time_comment": "Start time as ISO std string. ",
      "end_time": "2011-12-31",
      "end_time_comment": "End time as str of ISO std string",
      "file_pattern": "*a.pm*.pp",
      "file_pattern_comment":"pattern to match files to process"
  },
  "targets": {
      "_comments": "Values for 2011/01/01-2011/12/31",
        "RSR_NHX": 100.92789653071071,
  "RSR_TROPICS": 94.351948436291,
  "RSR_SHX": 108.07003375702631,
  "OLR_NHX": 222.51033996997268,
  "OLR_TROPICS": 259.6648869384575,
  "OLR_SHX": 215.6494141348897,
  "netflux_GLOBAL": 1.0002960308996771,
  "RSRC_NHX": 57.88614364284025,
  "RSRC_TROPICS": 50.906283403768875,
  "RSRC_SHX": 53.91469115012265,
  "LWC_NHX": 246.64962427406752,
  "LWC_TROPICS": 289.58392516800046,
  "LWC_SHX": 242.3799149538244,
  "Lprecip_NHX": 1.6315506854158856e-05,
  "Lprecip_TROPICS": 3.427597393351925e-05,
  "Lprecip_SHX": 1.9516884613338176e-05,
  "LAT_NHX": 275.49497960120345,
  "LAT_TROPICS": 297.0154358650638,
  "LAT_SHX": 287.32057998332033,
  "RH@500_NHX": 53.32394276739595,
  "RH@500_TROPICS": 34.47572649064447,
  "RH@500_SHX": 51.74152975462717,
  "TEMP@500_NHX": 251.08024567804642,
  "TEMP@500_TROPICS": 266.3688740700594,
  "TEMP@500_SHX": 249.01854867855468,
  "MSLP_NHX_DGM": 291.3739923612593,
  "MSLP_TROPICS_DGM": 167.2442415782134,
  "Reff_NHX": 12.506567555540895,
  "Reff_TROPICS": 15.51338513559003,
  "Reff_SHX": 13.526771334569421
},
  "scalings": {
    "comment": "Scalings on observables -- only defined when not 1.0. ",
    "lprecip_nhx": 86400.0,
    "lprecip_tropics": 86400.0,
    "lprecip_shx": 86400.0,
    "mslp_global": 0.01,
    "mslp_nhx_dgm": 0.01,
    "mslp_tropics_dgm": 0.01
  },
  "standardModel": {
    "SimulatedValues": {
      "comment": "Values from UKESM1 run for 2012/2013 . ",
      "temp@500_global": 258.23183096281565,
      "temp@500_nhx": 251.19094862447162,
      "temp@500_tropics": 266.62459492933675,
      "temp@500_shx": 248.48718536811563,
      "rh@500_global": 46.155222578001386,
      "rh@500_nhx": 56.49099976792841,
      "rh@500_tropics": 35.82319944932128,
      "rh@500_shx": 56.48349164543436,
      "olr_global": 241.3706152692112,
      "olr_nhx": 222.76483080049877,
      "olr_tropics": 264.15181651852913,
      "olr_shx": 214.41399723928552,
      "olrc_global": 263.41643028474164,
      "olrc_nhx": 244.32109828058057,
      "olrc_tropics": 285.0960257182804,
      "olrc_shx": 239.15257142182313,
      "rsr_global": 98.27957270190991,
      "rsr_nhx": 103.33666173642017,
      "rsr_tropics": 90.75895279736933,
      "rsr_shx": 108.26372347648034,
      "rsrc_global": 54.613543281373296,
      "rsrc_nhx": 60.965114552593796,
      "rsrc_tropics": 51.11780530458606,
      "rsrc_shx": 55.253447963726835,
      "insw_global": 340.41833087805344,
      "insw_nhx": 281.4590481003498,
      "insw_tropics": 399.3740718622483,
      "insw_shx": 281.46613168736417,
      "lat_global": 286.60816864121125,
      "lat_nhx": 275.26937976908914,
      "lat_tropics": 297.56836297367283,
      "lat_shx": 288.1714935082613,
      "lprecip_global": 2.668843223017746e-05,
      "lprecip_nhx": 1.923742017139813e-05,
      "lprecip_tropics": 3.4210951452646575e-05,
      "lprecip_shx": 2.357360333641164e-05,
      "mslp_global": 101194.46968031532,
      "netflux_global": 0.7681429069323404,
      "netflux_nhx": -44.64244443656917,
      "netflux_tropics": 44.46330254634976,
      "netflux_shx": -41.211589028401576,
      "mslp_nhx_dgm": 394.2607990951219,
      "mslp_tropics_dgm": 90.69621085005929
    }
  }
}
